tinymce.PluginManager.add("lists",function(e){var t=this;e.on("init",function(){function n(e){function t(t){var r,i,s;i=e[t?"startContainer":"endContainer"],s=e[t?"startOffset":"endOffset"],1==i.nodeType&&(r=b.create("span",{"data-mce-type":"bookmark"}),i.hasChildNodes()?(s=Math.min(s,i.childNodes.length-1),i.insertBefore(r,i.childNodes[s])):i.appendChild(r),i=r,s=0),n[t?"startContainer":"endContainer"]=i,n[t?"startOffset":"endOffset"]=s}var n={};return t(!0),t(),n}function r(e){function t(t){function n(e){for(var t=e.parentNode.firstChild,n=0;t;){if(t==e)return n;(1!=t.nodeType||"bookmark"!=t.getAttribute("data-mce-type"))&&n++,t=t.nextSibling}return-1}var r,i,s;r=s=e[t?"startContainer":"endContainer"],i=e[t?"startOffset":"endOffset"],1==r.nodeType&&(t?(i=n(r),r=r.parentNode):(i=n(r),r=r.parentNode),b.remove(s)),e[t?"startContainer":"endContainer"]=r,e[t?"startOffset":"endOffset"]=i}t(!0),t();var n=b.createRng();n.setStart(e.startContainer,e.startOffset),n.setEnd(e.endContainer,e.endOffset),w.setRng(n)}function i(e){return e&&/^(OL|UL)$/.test(e.nodeName)}function s(e){return e.parentNode.firstChild==e}function o(e){return e.parentNode.lastChild==e}function u(t){return t&&!!e.schema.getTextBlockElements()[t.nodeName]}function a(t,n){var r,i;if(e.settings.forced_root_block&&(n=n||e.settings.forced_root_block),i=n?b.create(n):b.createFragment(),t)for(;r=t.firstChild;)i.appendChild(r);return e.settings.forced_root_block||i.appendChild(b.create("br")),i.hasChildNodes()||tinymce.isIE||(i.innerHTML='<br data-mce-bogus="1">'),i}function f(){return tinymce.grep(w.getSelectedBlocks(),function(e){return"LI"==e.nodeName})}function l(){return tinymce.grep(w.getSelectedBlocks(),u)}function c(e,t,n){var r,i;n=n||a(t),r=b.createRng(),r.setStartAfter(t),r.setEndAfter(e),i=r.extractContents(),b.isEmpty(i)||b.insertAfter(i,e),b.isEmpty(n)||b.insertAfter(n,e),b.isEmpty(t.parentNode)&&b.remove(t.parentNode),b.remove(t)}function h(e){var t,n;if(t=e.nextSibling,t&&i(t)&&t.nodeName==e.nodeName){for(;n=t.firstChild;)e.appendChild(n);b.remove(t)}if(t=e.previousSibling,t&&i(t)&&t.nodeName==e.nodeName){for(;n=t.firstChild;)e.insertBefore(n,e.firstChild);b.remove(t)}}function p(e){tinymce.each(tinymce.grep(b.select("ol,ul",e)),function(e){var t,n=e.parentNode;"LI"==n.nodeName&&n.firstChild==e&&(t=n.previousSibling,t&&"LI"==t.nodeName&&(t.appendChild(e),b.isEmpty(n)&&b.remove(n))),i(n)&&(t=n.previousSibling,t&&"LI"==t.nodeName&&t.appendChild(e))})}function d(){var e,t=n(w.getRng(!0));return tinymce.each(f(),function(t){var n,r;return n=t.previousSibling,n&&"UL"==n.nodeName?(n.appendChild(t),void 0):n&&"LI"==n.nodeName&&i(n.lastChild)?(n.lastChild.appendChild(t),void 0):(n=t.nextSibling,n&&"UL"==n.nodeName?(n.insertBefore(t,n.firstChild),void 0):(n&&"LI"==n.nodeName&&i(t.lastChild)||(n=t.previousSibling,n&&"LI"==n.nodeName&&(r=b.create(t.parentNode.nodeName),n.appendChild(r),r.appendChild(t)),e=!0),void 0))}),r(t),e}function v(){function e(e){b.isEmpty(e)&&b.remove(e)}var t,u=n(w.getRng(!0));return tinymce.each(f(),function(n){var r,u=n.parentNode,f=u.parentNode;if(s(n)&&o(n))if("LI"==f.nodeName)b.insertAfter(n,f),e(f);else{if(!i(f))return;b.remove(u,!0)}else if(s(n))if("LI"==f.nodeName)b.insertAfter(n,f),r=b.create("LI"),r.appendChild(u),b.insertAfter(r,n),e(f);else{if(!i(f))return;f.insertBefore(n,u)}else if(o(n))if("LI"==f.nodeName)b.insertAfter(n,f);else{if(!i(f))return;b.insertAfter(n,u)}else{if("LI"==f.nodeName)u=f,r=a(n,"LI");else{if(!i(f))return;r=a(n,"LI")}c(u,n,r),p(u.parentNode)}t=!0}),r(u),t}function m(t){function s(){function t(t){var n,r,i=e.getBody();for(n=o[t?"startContainer":"endContainer"],r=o[t?"startOffset":"endOffset"],1==n.nodeType&&(n=n.childNodes[Math.min(r,n.childNodes.length-1)]||n);n.parentNode!=i;){if(u(n))return n;if(/^(TD|TH)$/.test(n.parentNode.nodeName))return n;n=n.parentNode}return n}function n(e,t){var n,r=[];if(!u(e)){for(;e&&(n=e[t?"previousSibling":"nextSibling"],!b.isBlock(n)&&n);)e=n;for(;e;)r.push(e),e=e[t?"nextSibling":"previousSibling"]}return r}var r,i,s=t(!0),a=t();i=n(s,!0),s!=a&&(i=i.concat(n(a).reverse())),tinymce.each(i,function(e){if(!b.isBlock(e)||"BR"==e.nodeName){if(!r||"BR"==e.nodeName){if("BR"==e.nodeName&&(!e.nextSibling||b.isBlock(e.nextSibling)&&"BR"!=e.nextSibling.nodeName))return b.remove(e),!1;r=b.create("p"),f.push(r),e.parentNode.insertBefore(r,e)}return"BR"!=e.nodeName?r.appendChild(e):b.remove(e),e==a?!1:void 0}})}var o=w.getRng(!0),a=n(o),f=l();s(),tinymce.each(f,function(e){var n,r;r=e.previousSibling,r&&i(r)&&r.nodeName==t?(n=r,e=b.rename(e,"LI"),r.appendChild(e)):(n=b.create(t),e.parentNode.insertBefore(n,e),n.appendChild(e),e=b.rename(e,"LI")),h(n)}),r(a)}function g(){var e=n(w.getRng(!0));tinymce.each(f(),function(e){var t,n;for(t=e;t;t=t.parentNode)i(t)&&(n=t);c(n,e)}),r(e)}function y(e){var t=b.getParent(w.getStart(),"OL,UL");if(t)if(t.nodeName==e)g(e);else{var i=n(w.getRng(!0));h(b.rename(t,e)),r(i)}else m(e)}var b=e.dom,w=e.selection;t.backspaceDelete=function(e){function t(e,t){var n=e.startContainer,r=e.startOffset;if(3==n.nodeType&&(t?r<n.data.length:r>0))return n;for(var i=new tinymce.dom.TreeWalker(e.startContainer);n=i[t?"next":"prev"]();)if(3==n.nodeType&&n.data.length>0)return n}function s(e,t){var n,r,s=e.parentNode;for(i(t.lastChild)&&(r=t.lastChild),n=t.lastChild,n&&"BR"==n.nodeName&&e.hasChildNodes()&&b.remove(n);n=e.firstChild;)t.appendChild(n);r&&t.appendChild(r),b.remove(e),b.isEmpty(s)&&b.remove(s)}if(w.isCollapsed()){var o=b.getParent(w.getStart(),"LI");if(o){var u=w.getRng(!0),a=b.getParent(t(u,e),"LI");if(a&&a!=o){var f=n(u);return e?s(a,o):s(o,a),r(f),!0}if(!a&&!e&&g(o.parentNode.nodeName))return!0}}},e.addCommand("Indent",function(){return d()?void 0:!0}),e.addCommand("Outdent",function(){return v()?void 0:!0}),e.addCommand("InsertUnorderedList",function(){y("UL")}),e.addCommand("InsertOrderedList",function(){y("OL")})}),e.on("keydown",function(e){e.keyCode==tinymce.util.VK.BACKSPACE?t.backspaceDelete()&&e.preventDefault():e.keyCode==tinymce.util.VK.DELETE&&t.backspaceDelete(!0)&&e.preventDefault()})});