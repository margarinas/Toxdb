tinymce.PluginManager.add("noneditable",function(e){function t(){function t(e){var t;if(1===e.nodeType){if(t=e.getAttribute(a),t&&"inherit"!==t)return t;if(t=e.contentEditable,"inherit"!==t)return t}return null}function n(e){for(var n;e;){if(n=t(e))return"false"===n?e:null;e=e.parentNode}}function r(e){for(;e;){if(e.id===v)return e;e=e.parentNode}}function i(e){var t;if(e)for(t=new o(e,e),e=t.current();e;e=t.next())if(3===e.nodeType)return e}function s(n,r){var i,s;return"false"===t(n)&&p.isBlock(n)?(d.select(n),void 0):(s=p.createRng(),"true"===t(n)&&(n.firstChild||n.appendChild(e.getDoc().createTextNode(" ")),n=n.firstChild,r=!0),i=p.create("span",{id:v,"data-mce-bogus":!0},m),r?n.parentNode.insertBefore(i,n):p.insertAfter(i,n),s.setStart(i.firstChild,1),s.collapse(!0),d.setRng(s),i)}function u(e){var t,n,s,o;if(e)t=d.getRng(!0),t.setStartBefore(e),t.setEndBefore(e),n=i(e),n&&n.nodeValue.charAt(0)==m&&(n=n.deleteData(0,1)),p.remove(e,!0),d.setRng(t);else for(s=r(d.getStart());(e=p.get(v))&&e!==o;)s!==e&&(n=i(e),n&&n.nodeValue.charAt(0)==m&&(n=n.deleteData(0,1)),p.remove(e,!0)),o=e}function l(){function e(e,n){var r,i,s,u,a;if(r=f.startContainer,i=f.startOffset,3==r.nodeType){if(a=r.nodeValue.length,i>0&&a>i||(n?i==a:0===i))return}else{if(!(i<r.childNodes.length))return n?null:e;var l=!n&&i>0?i-1:i;r=r.childNodes[l],r.hasChildNodes()&&(r=r.firstChild)}for(s=new o(r,e);u=s[n?"prev":"next"]();){if(3===u.nodeType&&u.nodeValue.length>0)return;if("true"===t(u))return u}return e}var r,i,a,f,l;u(),a=d.isCollapsed(),r=n(d.getStart()),i=n(d.getEnd()),(r||i)&&(f=d.getRng(!0),a?(r=r||i,(l=e(r,!0))?s(l,!0):(l=e(r,!1))?s(l,!1):d.select(r)):(f=d.getRng(!0),r&&f.setStartBefore(r),i&&f.setEndAfter(i),d.setRng(f)))}function h(i){function s(e,t){for(;e=e[t?"previousSibling":"nextSibling"];)if(3!==e.nodeType||e.nodeValue.length>0)return e}function a(e,t){d.select(e),d.collapse(t)}function h(i){function s(e){for(var t=a;t;){if(t===e)return;t=t.parentNode}p.remove(e),l()}function o(){var r,o,u=e.schema.getNonEmptyElements();for(o=new tinymce.dom.TreeWalker(a,e.getBody());(r=i?o.prev():o.next())&&!u[r.nodeName.toLowerCase()]&&!(3===r.nodeType&&tinymce.trim(r.nodeValue).length>0);)if("false"===t(r))return s(r),!0;return n(r)?!0:!1}var u,a,f,c;if(d.isCollapsed()){if(u=d.getRng(!0),a=u.startContainer,f=u.startOffset,a=r(a)||a,c=n(a))return s(c),!1;if(3==a.nodeType&&(i?f>0:f<a.nodeValue.length))return!0;if(1==a.nodeType&&(a=a.childNodes[f]||a),o())return!1}return!0}var v,m,g,y,b=i.keyCode;if(g=d.getStart(),y=d.getEnd(),v=n(g)||n(y),v&&(112>b||b>124)&&b!=f.DELETE&&b!=f.BACKSPACE){if((tinymce.isMac?i.metaKey:i.ctrlKey)&&(67==b||88==b||86==b))return;if(i.preventDefault(),b==f.LEFT||b==f.RIGHT){var w=b==f.LEFT;if(e.dom.isBlock(v)){var E=w?v.previousSibling:v.nextSibling,S=new o(E,E),x=w?S.prev():S.next();a(x,!w)}else a(v,w)}}else if(b==f.LEFT||b==f.RIGHT||b==f.BACKSPACE||b==f.DELETE){if(m=r(g)){if(b==f.LEFT||b==f.BACKSPACE)if(v=s(m,!0),v&&"false"===t(v)){if(i.preventDefault(),b!=f.LEFT)return p.remove(v),void 0;a(v,!0)}else u(m);if(b==f.RIGHT||b==f.DELETE)if(v=s(m),v&&"false"===t(v)){if(i.preventDefault(),b!=f.RIGHT)return p.remove(v),void 0;a(v,!1)}else u(m)}if((b==f.BACKSPACE||b==f.DELETE)&&!h(b==f.BACKSPACE))return i.preventDefault(),!1}}var p=e.dom,d=e.selection,v="mce_noneditablecaret",m="﻿";e.on("mousedown",function(n){var r=e.selection.getNode();"false"===t(r)&&r==n.target&&l()}),e.on("mouseup keyup",l),e.on("keydown",h)}function n(t){var n=s.length,r=t.content,o=tinymce.trim(i);if("raw"!=t.format){for(;n--;)r=r.replace(s[n],function(t){var n=arguments,i=n[n.length-2];return i>0&&'"'==r.charAt(i-1)?t:'<span class="'+o+'" data-mce-content="'+e.dom.encode(n[0])+'">'+e.dom.encode("string"==typeof n[1]?n[1]:n[0])+"</span>"});t.content=r}}var r,i,s,o=tinymce.dom.TreeWalker,u="contenteditable",a="data-mce-"+u,f=tinymce.util.VK;r=" "+tinymce.trim(e.getParam("noneditable_editable_class","mceEditable"))+" ",i=" "+tinymce.trim(e.getParam("noneditable_noneditable_class","mceNonEditable"))+" ",s=e.getParam("noneditable_regexp"),s&&!s.length&&(s=[s]),e.on("PreInit",function(){t(),s&&e.on("BeforeSetContent",n),e.parser.addAttributeFilter("class",function(e){for(var t,n,s=e.length;s--;)n=e[s],t=" "+n.attr("class")+" ",-1!==t.indexOf(r)?n.attr(a,"true"):-1!==t.indexOf(i)&&n.attr(a,"false")}),e.serializer.addAttributeFilter(a,function(e){for(var t,n=e.length;n--;)t=e[n],s&&t.attr("data-mce-content")?(t.name="#text",t.type=3,t.raw=!0,t.value=t.attr("data-mce-content")):(t.attr(u,null),t.attr(a,null))}),e.parser.addAttributeFilter(u,function(e){for(var t,n=e.length;n--;)t=e[n],t.attr(a,t.attr(u)),t.attr(u,null)})})});