tinymce.PluginManager.add("autolink",function(e){function t(e){i(e,-1,"(",!0)}function n(e){i(e,0,"",!0)}function r(e){i(e,-1,"",!1)}function i(e,t,n){var r,i,s,o,u,a,f,l,c;if(r=e.selection.getRng(!0).cloneRange(),r.startOffset<5){if(l=r.endContainer.previousSibling,!l){if(!r.endContainer.firstChild||!r.endContainer.firstChild.nextSibling)return;l=r.endContainer.firstChild.nextSibling}if(c=l.length,r.setStart(l,c),r.setEnd(l,c),r.endOffset<5)return;i=r.endOffset,o=l}else{if(o=r.endContainer,3!=o.nodeType&&o.firstChild){for(;3!=o.nodeType&&o.firstChild;)o=o.firstChild;3==o.nodeType&&(r.setStart(o,0),r.setEnd(o,o.nodeValue.length))}i=1==r.endOffset?2:r.endOffset-1-t}s=i;do r.setStart(o,i>=2?i-2:0),r.setEnd(o,i>=1?i-1:0),i-=1;while(" "!=r.toString()&&""!==r.toString()&&160!=r.toString().charCodeAt(0)&&i-2>=0&&r.toString()!=n);if(r.toString()==n||160==r.toString().charCodeAt(0)?(r.setStart(o,i),r.setEnd(o,s),i+=1):0===r.startOffset?(r.setStart(o,0),r.setEnd(o,s)):(r.setStart(o,i),r.setEnd(o,s)),a=r.toString(),"."==a.charAt(a.length-1)&&r.setEnd(o,s-1),a=r.toString(),f=a.match(/^(https?:\/\/|ssh:\/\/|ftp:\/\/|file:\/|www\.|(?:mailto:)?[A-Z0-9._%+\-]+@)(.+)$/i),f&&("www."==f[1]?f[1]="http://www.":/@$/.test(f[1])&&!/^mailto:/.test(f[1])&&(f[1]="mailto:"+f[1]),u=e.selection.getBookmark(),e.selection.setRng(r),e.execCommand("createlink",!1,f[1]+f[2]),e.selection.moveToBookmark(u),e.nodeChanged(),tinymce.Env.webkit)){e.selection.collapse(!1);var h=Math.min(o.length,s+1);r.setStart(o,h),r.setEnd(o,h),e.selection.setRng(r)}}e.on("keydown",function(t){return 13==t.keyCode?r(e):void 0}),tinymce.Env.ie||(e.on("keypress",function(n){return 41==n.which?t(e):void 0}),e.on("keyup",function(t){return 32==t.keyCode?n(e):void 0}))});