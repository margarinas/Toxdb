tinymce.PluginManager.add("autosave",function(e){function t(e,t){var n={s:1e3,m:6e4};return e=/^(\d+)([ms]?)$/.exec(""+(e||t)),(e[2]?n[e[2]]:1)*parseInt(e,10)}function n(){var e=parseInt(h.getItem(p+"autosave.time"),10)||0;return(new Date).getTime()-e>c.autosave_retention?(r(),!1):!0}function r(){h.removeItem(p+"autosave.draft"),h.removeItem(p+"autosave.time")}function i(){l&&e.isDirty()&&(h.setItem(p+"autosave.draft",e.getContent({format:"raw",no_events:!0})),h.setItem(p+"autosave.time",(new Date).getTime()),e.fire("StoreDraft"))}function s(){n()&&(e.setContent(h.getItem(p+"autosave.draft"),{format:"raw"}),r(),e.fire("RestoreDraft"))}function o(){l||(setInterval(function(){e.removed||i()},c.autosave_interval),l=!0)}function u(){var t=this;t.disabled(!n()),e.on("StoreDraft RestoreDraft",function(){t.disabled(!n())}),o()}function a(){e.undoManager.beforeChange(),s(),e.undoManager.add()}function f(){var e;return tinymce.each(tinymce.editors,function(t){t.plugins.autosave&&t.plugins.autosave.storeDraft(),!e&&t.isDirty()&&t.getParam("autosave_ask_before_unload",!0)&&(e=t.translate("You have unsaved changes are you sure you want to navigate away?"))}),e}var l,c=e.settings,h=tinymce.util.LocalStorage,p=e.id;c.autosave_interval=t(c.autosave_interval,"30s"),c.autosave_retention=t(c.autosave_retention,"20m"),e.addButton("restoredraft",{title:"Restore last draft",onclick:a,onPostRender:u}),e.addMenuItem("restoredraft",{text:"Restore last draft",onclick:a,onPostRender:u,context:"file"}),this.storeDraft=i,window.onbeforeunload=f});