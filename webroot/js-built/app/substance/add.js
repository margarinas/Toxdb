define(["jquery","utils/autocomplete","utils/addEditor","utils/listGroups","utils/tableRow","common","bootstrap","utils/incrementInput"],function(e,t,n,r,i){function s(o){n.init(),r.init(),defaults={container:"#container",redirectTo:"index",postCallback:null};var u=e.extend(defaults,o);typeof tinyMCE!="undefined"&&e(u.container+" textarea").each(function(e){tinyMCE.execCommand("mceRemoveEditor",!1,this.id),tinyMCE.execCommand("mceAddEditor",!1,this.id)}),e("#SubstanceAddForm").submit(function(t){e(".substance_create textarea").each(function(e){tinyMCE.execCommand("mceRemoveEditor",!1,this.id)}),data=e(this).serialize(),data=data+"&"+e.param({redirectTo:u.redirectTo}),url=e(this).attr("action"),e.ajax({beforeSend:function(t){e("#busy-indicator").fadeIn()},complete:function(t,n){e("#busy-indicator").fadeOut(),e(u.container).parent().scrollTop(0),s(u),typeof u.postCallback=="function"&&u.postCallback(t)},success:function(t,n){e(u.container).html(t)},method:"post",data:data,url:url}),e(".modal-body").scrollTop(0),e(".agent_search_results").empty(),t.preventDefault()}),t.init(".autocomplete"),e(".substance_create .add_agent").click(function(t){var n=e(".substance_create .agent").length;e(".substance_create .accordion-body").collapse("hide"),tinyMCE.execCommand("mceFocus",!1,"Agent0Description"),tinyMCE.execCommand("mceRemoveEditor",!1,"Agent0Description");var i=e(".substance_create .agent").first().clone();i.find("input:not(.clone-with-value), textarea").val(null).end().find("label, input, a.accordion-toggle, div.accordion-body, textarea, select").each(function(t){incrementInput(e(this),n)}),e(".substance_create .agents").append(i.find(".agent_remove").show().end()),tinyMCE.execCommand("mceAddEditor",!1,"Agent0Description"),tinyMCE.execCommand("mceAddEditor",!1,"Agent"+n+"Description"),e(".substance_create .agent").last().find(".accordion-body").collapse("show"),e(".substance_create .agent").last().find(".poison_subgroup").empty().hide(),e(".substance_create .agent").last().find(".agent_remove").click(function(t){e(this).parents(".agent").slideUp(200,function(){tinyMCE.execCommand("mceRemoveEditor",!1,e(this).find("textarea").attr("id")),e(this).remove()})}),r.init()}),e(".agent_remove").click(function(t){e(this).parents(".agent").slideUp(200,function(){tinyMCE.execCommand("mceRemoveEditor",!1,e(this).find("textarea").attr("id")),e(this).remove()})}),e(".search_agent").click(function(t){e(".agent_search_results").load(baseUrl+"agents/index/",{term:e(this).prev().val()},function(){i.init(".agent_row",".agent_search_results")}),e("#agent_to_substance").show(),e(".substance_create .accordion-body").collapse("hide")}),e("#agent_to_substance").click(function(t){e(".agents_attached").append(e(".select_agent:checked").next().find("input:checkbox").prop("checked","checked").end().find(".agent_dose_field, .agent-main-group").remove().end().show()),e(".agent_search_results").empty(),e(this).hide()}),e("#SubstanceNoagents").change(function(t){e("#substance-add-agents").toggle()})}return{init:s}});