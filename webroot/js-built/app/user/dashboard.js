define(["utils/poisonAutocomplete","utils/modal","app/substance/actions","utils/getElement","app/event/report","app/event/index","app/call/index","app/draft/index"],function(e,t,n,r,i,s,o,u){function a(f){if(typeof f!="object"&&typeof f!="undefined")throw new Error("Must provide options as an object");e.init("#SubstanceTerm"),defaults={container:"#container",history:!0};var l=$.extend(defaults,f),c={show:!0,id:"add_substance",title:"Ieškoti nuodingosios medžiagos",footer:'<button class="btn" data-dismiss="modal" aria-hidden="true">Close</button>'},h;r.loadElement({name:"substance/actions"},function(e){h=e}),$("#SubstanceSearchForm").submit(function(e){return t.set(c,function(){$(".modal-header").after($(h).addClass("margin10")),n.init({container:".modal-body",rowLimit:7,history:!1,searchCallback:function(){$(".modal-body .actions").hide()}}),$("#add_substance").on("hidden",function(e){$(e.target).hasClass("modal")&&$(".modal .substance-actions").remove()})}),e.preventDefault(),!1});var p=new Date;p.setDate(p.getDate()-7),p=$.datepicker.formatDate("yy-mm-dd",p),$(".event-list").load(baseUrl+"events/find/noSearchForm:1/event_per_page:5/current_user:1/created_from:"+p,function(){$(".event-select-collum, .event-user-collum").remove(),$("#busy-indicator").fadeOut(),s.init({container:".event-list",showPaginatorSummary:!1,callback:function(){$(".event-select-collum, .event-user-collum").remove()}})}),$(".draft-list").load(baseUrl+"drafts/index/Event",function(){$("#busy-indicator").fadeOut(),u.init({container:".draft-list",showPaginatorSummary:!1})}),$(".user-menu a").on("click",function(e){$("#busy-indicator").fadeIn(),$(".user-menu li").removeClass("active"),$(this).parent().addClass("active"),url=e.target.href,$("#container").load(url,function(){$("#busy-indicator").fadeOut(),dest=url.split("/").pop();switch(dest){case"":a();break;case"report":i.init();break;case"calls":o.init()}history.pushState(null,null,url)}),e.preventDefault()})}return{init:a}});